<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="https://cdn.bootcss.com/jquery/1.10.1/jquery.min.js"></script>
    <script>
        res = {
            "errorCode": 0,
            "errorMsg": "",
            "data": [{
                "barcode": "条码0",
                "batchNo": "000000",
                "doCode": "派工单号0",
                "equipmentId": "设备ID0",
                "equipmentName": "设备名称0",
                "happenTime": "2017-09-11T08:18:43.733Z",
                "in": [{
                    "barcode": "条码01",
                    "batchNo": "批次号01",
                    "doCode": "派工单号01",
                    "equipmentId": "设备ID01",
                    "equipmentName": "设备名称01",
                    "happenTime": "2017-09-11T08:18:43.733Z",
                    "materialCode": "物料编码01",
                    "materialName": "物料名称01",
                    "personName": "操作人01",
                    "quantity": "数量01",
                    "shiftName": "班次01"
                },{
                    "barcode": "条码02",
                    "batchNo": "批次号02",
                    "doCode": "派工单号02",
                    "equipmentId": "设备ID02",
                    "equipmentName": "设备名称02",
                    "happenTime": "2017-09-11T08:18:43.733Z",
                    "materialCode": "物料编码02",
                    "materialName": "物料名称02",
                    "personName": "操作人02",
                    "quantity": "数量02",
                    "shiftName": "班次02"
                }],
                "materialCode": "物料编码0",
                "materialName": "物料名称0",
                "moldCode": "模号0",
                "personName": "操作人0",
                "qualifiedNum": "合格数0",
                "quantity": "2",
                "scrapNum": "报废数0",
                "shiftName": "班次0",
                "unqualifiedNum": "不合格数0"
            }, {
                "barcode": "条码2",
                "batchNo": "222222",
                "doCode": "派工单号2",
                "equipmentId": "设备ID2",
                "equipmentName": "设备名称2",
                "happenTime": "2017-09-11T08:18:43.733Z",
                "in": [{
                    "barcode": "条码21",
                    "batchNo": "批次号21",
                    "doCode": "派工单号21",
                    "equipmentId": "设备ID21",
                    "equipmentName": "设备名称21",
                    "happenTime": "2017-09-11T08:18:43.733Z",
                    "materialCode": "物料编码21",
                    "materialName": "物料名称21",
                    "personName": "操作人21",
                    "quantity": "数量21",
                    "shiftName": "班次21"
                }],
                "materialCode": "物料编码2",
                "materialName": "物料名称2",
                "moldCode": "模号2",
                "personName": "操作人2",
                "qualifiedNum": "合格数2",
                "quantity": "4",
                "scrapNum": "报废数2",
                "shiftName": "班次2",
                "unqualifiedNum": "不合格数2"
            }, {
                "barcode": "条码3",
                "batchNo": "000000",
                "doCode": "派工单号3",
                "equipmentId": "设备ID3",
                "equipmentName": "设备名称3",
                "happenTime": "2017-09-11T08:18:43.733Z",
                "in": [{
                    "barcode": "条码31",
                    "batchNo": "批次号31",
                    "doCode": "派工单号31",
                    "equipmentId": "设备ID31",
                    "equipmentName": "设备名称31",
                    "happenTime": "2017-09-11T08:18:43.733Z",
                    "materialCode": "物料编码31",
                    "materialName": "物料名称31",
                    "personName": "操作人31",
                    "quantity": "数量31",
                    "shiftName": "班次31"
                }],
                "materialCode": "物料编码3",
                "materialName": "物料名称3",
                "moldCode": "模号3",
                "personName": "操作人3",
                "qualifiedNum": "合格数3",
                "quantity": "6",
                "scrapNum": "报废数3",
                "shiftName": "班次3",
                "unqualifiedNum": "不合格数3"
            }, {
                "barcode": "条码4",
                "batchNo": "222222",
                "doCode": "派工单号4",
                "equipmentId": "设备ID4",
                "equipmentName": "设备名称2",
                "happenTime": "2017-09-11T08:18:43.733Z",
                "in": [{
                    "barcode": "条码41",
                    "batchNo": "批次号41",
                    "doCode": "派工单号41",
                    "equipmentId": "设备ID41",
                    "equipmentName": "设备名称41",
                    "happenTime": "2017-09-11T08:18:43.733Z",
                    "materialCode": "物料编码41",
                    "materialName": "物料名称41",
                    "personName": "操作人41",
                    "quantity": "数量41",
                    "shiftName": "班次41"
                },{
                    "barcode": "条码42",
                    "batchNo": "批次号42",
                    "doCode": "派工单号42",
                    "equipmentId": "设备ID42",
                    "equipmentName": "设备名称42",
                    "happenTime": "2017-09-11T08:18:43.733Z",
                    "materialCode": "物料编码42",
                    "materialName": "物料名称42",
                    "personName": "操作人42",
                    "quantity": "数量42",
                    "shiftName": "班次42"
                }],
                "materialCode": "物料编码4",
                "materialName": "物料名称4",
                "moldCode": "模号4",
                "personName": "操作人4",
                "qualifiedNum": "合格数4",
                "quantity": "8",
                "scrapNum": "报废数4",
                "shiftName": "班次4",
                "unqualifiedNum": "不合格数4"
            }, {
                "barcode": "条码5",
                "batchNo": "222222",
                "doCode": "派工单号4",
                "equipmentId": "设备ID4",
                "equipmentName": "设备名称2",
                "happenTime": "2017-09-11T08:18:43.733Z",
                "in": [{
                    "barcode": "条码41",
                    "batchNo": "批次号41",
                    "doCode": "派工单号41",
                    "equipmentId": "设备ID41",
                    "equipmentName": "设备名称41",
                    "happenTime": "2017-09-11T08:18:43.733Z",
                    "materialCode": "物料编码41",
                    "materialName": "物料名称41",
                    "personName": "操作人41",
                    "quantity": "数量41",
                    "shiftName": "班次41"
                },{
                    "barcode": "条码42",
                    "batchNo": "批次号42",
                    "doCode": "派工单号42",
                    "equipmentId": "设备ID42",
                    "equipmentName": "设备名称42",
                    "happenTime": "2017-09-11T08:18:43.733Z",
                    "materialCode": "物料编码42",
                    "materialName": "物料名称42",
                    "personName": "操作人42",
                    "quantity": "数量42",
                    "shiftName": "班次42"
                }],
                "materialCode": "物料编码4",
                "materialName": "物料名称4",
                "moldCode": "模号4",
                "personName": "操作人4",
                "qualifiedNum": "合格数4",
                "quantity": "8",
                "scrapNum": "报废数4",
                "shiftName": "班次4",
                "unqualifiedNum": "不合格数4"
            }, {
                "barcode": "条码6",
                "batchNo": "666666",
                "doCode": "派工单号4",
                "equipmentId": "设备ID4",
                "equipmentName": "设备名称2",
                "happenTime": "2017-09-11T08:18:43.733Z",
                "in": [{
                    "barcode": "条码41",
                    "batchNo": "批次号41",
                    "doCode": "派工单号41",
                    "equipmentId": "设备ID41",
                    "equipmentName": "设备名称41",
                    "happenTime": "2017-09-11T08:18:43.733Z",
                    "materialCode": "物料编码41",
                    "materialName": "物料名称41",
                    "personName": "操作人41",
                    "quantity": "数量41",
                    "shiftName": "班次41"
                },{
                    "barcode": "条码42",
                    "batchNo": "批次号42",
                    "doCode": "派工单号42",
                    "equipmentId": "设备ID42",
                    "equipmentName": "设备名称42",
                    "happenTime": "2017-09-11T08:18:43.733Z",
                    "materialCode": "物料编码42",
                    "materialName": "物料名称42",
                    "personName": "操作人42",
                    "quantity": "数量42",
                    "shiftName": "班次42"
                }],
                "materialCode": "物料编码4",
                "materialName": "物料名称4",
                "moldCode": "模号4",
                "personName": "操作人4",
                "qualifiedNum": "合格数4",
                "quantity": "8",
                "scrapNum": "报废数4",
                "shiftName": "班次4",
                "unqualifiedNum": "不合格数4"
            }]
        }
        function cc(){
            console.log("indata")
            console.log(indata)
            console.log("outdata")
            console.log(outdata)
            console.log("tabledata")
            console.log(tabledata)
            console.log("all")
            console.log(all)
        }
        var oData = res.data
        var indata = []
        var outdata  = []
        var tabledata = []
        oData.forEach((e,index)=>{
            let iData = e.in
            indata.push(...iData)
           // delete e["in"]
            outdata.push(e)
            tabledata.push(e)
            tabledata.push(...iData)
        });



        all = [];   // 根据投入和产出明细的汇总

        outdataCopy = JSON.parse(JSON.stringify(outdata))
        outdataCopy.forEach((el,i)=>{
            all.push({
                barcode: outdataCopy[i]["barcode"],
                batchNo: outdataCopy[i]["batchNo"],
                quantity: parseInt(outdataCopy[i]["quantity"])
            })
            for (j = i+1 ; j < outdataCopy.length; j++){
                if (el["batchNo"] === outdataCopy[j]["batchNo"]){
                    all[i].quantity = parseInt(outdataCopy[i]["quantity"])+parseInt(outdataCopy[j]["quantity"])
                    outdataCopy.splice(j, 1)
                    j=j-1   
                }
            }
        })



        
        
    </script>
</head>

<body>
    <button onclick="cc()" style="width:200px;height:100px;"></button>
</body>

</html>



